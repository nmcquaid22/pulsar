{% extends "@pulsar/pulsar/components/tab.html.twig" %}
{% set i = 1 %}

{% 
    set data = {
        'columns': [
            { 'title': 'Date' },
            { 'title': 'Active', 'attrs': {
                    'class': 'shrink-to-fit u-text-align-center',
                    'data-orderable': 'false',
                    'id': 'aria-actions-label'
                }
            }
        ],
        'data': [
            {
                'Title': {
                    'label': 'Monday 01/10/2018',
                    'data-order': '2018-10-01 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': true,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                }
            },
            {
                'Title': {
                    'label': 'Monday 15/10/2018',
                    'data-order': '2018-10-15 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': true,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                },
            },
            {
                'Title': {
                    'label': 'Monday 29/10/2018',
                    'data-order': '2018-10-29 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': true,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                }
            },
            {
                'Title': {
                    'label': 'Monday 30/10/2018',
                    'data-order': '2018-10-30 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': true,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                }
            },
            {
                'Title': {
                    'label': 'Tuesday 30/10/2018 ' ~ html.label({'label': 'one-off', 'class': 'label--info'}),
                    'data-order': '2018-10-30 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': true,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                }
            },
            {
                'Title': {
                    'label': 'Monday 12/11/2018',
                    'data-order': '2018-11-12 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': true,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                }
            },
            {
                'Title': {
                    'label': 'Monday 26/11/2018',
                    'data-order': '2018-11-26 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': false,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                }
            },
            {
                'Title': {
                    'label': 'Monday 10/12/2018',
                    'data-order': '2018-12-10 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': true,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                }
            },
            {
                'Title': {
                    'label': 'Monday 24/12/2018',
                    'data-order': '2018-12-24 00:00'
                },
                'Active': {
                    'label': form.checkbox({ 
                        'aria-described-by': 'aria-actions-label',
                        'checked': true,
                        'bare': true    
                    }),
                    'class': 'u-text-align-center'
                }
            }
        ]
    }
%}

{%- block actions_left -%}
    {{
        html.actions_menu({
            'items': [
                [
                    {
                        'label': 'Create New Page',
                        'href': '#one',
                        'icon': 'file-text-o'
                    }
                ],
                [
                    {
                        'label': 'Save',
                        'href': '#save',
                        'icon': 'save'
                    },
                    {
                        'label': 'Send for approval',
                        'href': '#workflow-submit',
                        'data-toggle': 'modal',
                        'icon': 'hand-o-right'
                    }
                ],
                [
                    {
                        'label': 'Lock',
                        'href': '#lock',
                        'icon': 'lock'
                    },
                    {
                        'label': 'Collaborate',
                        'href': '#collaborate',
                        'icon': 'user-plus'
                    }
                ],
                [
                    {
                        'label': 'Preview',
                        'href': '#preview',
                        'icon': 'eye-open'
                    },
                    {
                        'label': 'View history',
                        'href': '#history',
                        'icon': 'history'
                    }
                ],
                [
                    {
                        'class': 'link--danger',
                        'label': 'Delete',
                        'href': '#delete',
                        'icon': 'remove'
                    }
                ],
            ]
        })
    }}
{%- endblock -%}

{%- block actions_right -%}
    {{
        html.button({
            'label': 'Save',
            'class': 'btn--primary',
            'data-toggle': 'modal',
            'type': 'link',
            'href': '#'
        })
    }}
{%- endblock -%}

{% block tab_content %}
    
    {{
        form.create({
        })
    }}

    {{
        form.text({
            'label': 'Title',
            'class': 'form__group--xxlarge',
            'required': true
        })
    }}

    {{
        form.date({
            'label': 'Date of event',
			'class': 'form__group--medium',
            'prepend': html.icon('calendar'),
            'required': true
        })
    }}

    {#
        form.compound({
            'label': 'Duration of event',
            'id': 'duration',
            'required': true,
            'inputs': [
                {
                    'class': 'form__control-col--1',
                    'label': 'From',
                    'id': 'duration-from',
                    'show-label': false,
                    'required': true,
                    'type': 'time',
                    'prepend': html.icon('clock-o')
                },
                {
                    'class': 'form__control-col--1',
                    'label': 'To',
                    'id': 'duration-to',
                    'show-label': false,
                    'required': true,
                    'type': 'time',
                    'prepend': html.icon('clock-o')
                }
            ]
        })
    #}
	<style>
		#duration label {
			margin-left: 0;
			padding-top: 11px;
			padding-right: 10px;
		}
	</style>
	<fieldset id="duration" class="form__group form__group--compound"><legend class="control__label" id="duration[label]">Duration of event <span class="required-indicator" rel="tooltip" data-toggle="tooltips" title="" data-original-title="required">*</span></legend>
	<div class="controls">
		<label for="duration-from" id="duration-from[label]" class="control__label hide ">From</label><input id="duration-from" type="time" class="form__control form__control-col--1"><label for="duration-to" id="duration-to[label]" class="control__label">To</label><input id="duration-to" type="time" class="form__control form__control-col--1"></div></fieldset>

    {{ 
        form.fieldset_start({
            'legend': 'Event details'
        })
    }}

    {{
        form.content({
            'label': 'Categories',
			'id': 'categories',
			'name': 'categories',
            'required': true,
			'value': html.button({
				'label': 'Assign Categories'
			})
        })
    }}

	{{
        form.content({
            'label': 'Metadata',
			'id': 'metadata',
			'name': 'metadata',
            'required': true,
			'value': html.button({
				'label': 'Assign Metadata'
			})
        })
    }}

	{{
        form.content({
            'label': 'Location',
			'id': 'location',
			'name': 'location',
            'required': true,
			'value': html.button({
				'label': 'Assign Location'
			})
        })
    }}

	{{
        form.text({
            'label': 'Cost',
			'class': 'form__group--medium',
			'id': 'cost',
			'name': 'cost',
			'prepend': '£'
        })
    }}

	{{
        form.textarea({
            'label': 'Summary',
			'id': 'summary',
			'name': 'summary',
			'rows': 5
        })
    }}

	{{
        form.textarea({
            'label': 'Description',
			'id': 'description',
			'name': 'description',
			'rows': 10
        })
    }}

	{{
        form.checkbox({
            'label': 'Pick of the week',
			'id': 'potw',
			'name': 'potw'
        })
    }}

    {{ form.fieldset_end() }}

    {{ 
        form.fieldset_start({
            'legend': 'Repeat event'
        })
    }}

    <p>Make this event recur on a defined schedule, you can add a repeat pattern and add/remove specific dates to fine tune when your event will run</p>

    <script>
        (function ($) {
            $(window).load(function() {
                $('#repeat-pattern').change(function() {
                    if ($(this).val() == 'custom') {
                        $('.js-custom-recurrence').removeClass('hide');
                    } else {
                        $('.js-custom-recurrence').addClass('hide');
                    }
                });
            });
        }(jQuery));
    </script>

    {{
        form.select({
            'label': 'Repeat',
            'class': 'form__group--large',
            'id': 'repeat-pattern',
            'name': 'repeat-pattern',
            'options': {
                '': "Please choose...",
                'daily': 'Daily',
                'weekly': 'Weekly on Monday',
                'two-weekly': 'Every two weeks, on Monday',
                'three-weekly': 'Three Weekly',
                'four-weekly': 'Four Weekly',
                'monthly': 'Monthly on the 23rd',
                'annually': 'Annually',
                'custom': 'Custom pattern'
            },
            'selected': 'two-weekly'
        })
    }}

    {{ form.fieldset_start({'class': 'js-custom-recurrence hide u-padding-top-none u-padding-bottom-none'}) }}

        {{
            form.text({
                'label': 'Repeat every',
                'class': 'form__group--medium',
                'id': 'repeat-every',
                'name': 'repeat-every',
                'append': 'weeks',
                'required': true,
                'value': '1',
                'help': 'The number of weeks which should pass before the event reoccurs'
            })
        }}

        {{
            form.choice({
                'label': 'Repeat on',
                'class': 'choice--bubbles choice--bubbles-inline',
                'multiple': true,
                'optimize': 'few',
                'required': true,
                'help': 'You must choose at least one day for the event to occur on',
                'options': [
                    {
                        'label': 'MO',
                        'value': 'mon',
                        'name': 'days'
                    },
                    {
                        'label': 'TU',
                        'value': 'tue',
                        'name': 'days'
                    },
                    {
                        'label': 'WE',
                        'value': 'wed',
                        'name': 'days'
                    },
                    {
                        'label': 'TH',
                        'value': 'thu',
                        'name': 'days'
                    },
                    {
                        'label': 'FR',
                        'value': 'fri',
                        'name': 'days'
                    },
                    {
                        'label': 'SA',
                        'value': 'sat',
                        'name': 'days'
                    },
                    {
                        'label': 'SU',
                        'value': 'sun',
                        'name': 'days'
                    }
                ]
            })
        }}

        {{ form.fieldset_end() }}



    <!-- NOT PRODUCTION QUALITY!!!!!!!! DO NOT SHIP THIS JAVASCRIPT!!!!! -->
    <script>
        (function ($) {
            $(window).load(function(){
                $('[data-show="js-end-repeat"]').on('change', function() {
                    if ($(this).is(':checked')) {
                        $('.js-end-repeat').removeClass('hide');
                        $('#end-date').removeAttr('disabled').removeClass('is-disabled');
                    }
                });

                $('[data-hide="js-end-repeat"]').on('change', function() {
                    if ($(this).is(':checked')) {
                        $('#end-date')
                            .addClass('is-disabled')
                            .attr('disabled', 'disabled');
                        $('.js-end-repeat').addClass('hide');
                    }
                });
            });
        }(jQuery));
    </script>

    {{
        form.choice({
            'label': 'Repeat ends',
            'options': [
                {
                    'label': 'Never',
                    'value': 'never',
                    'name': 'ends',
                    'data-hide': 'js-end-repeat',
                    'checked': true
                },
                {
                    'label': 'On date',
                    'value': 'date',
                    'data-show': 'js-end-repeat',
                    'name': 'ends'
                }
            ]
        })
    }}

    {{
        form.date({
            'label': 'End repeat after',
            'class': 'form__group--medium hide js-end-repeat',
            'prepend': html.icon('calendar'),
            'id': 'end-date',
            'name': 'end-date',
            'help': 'Events will stop repeating <strong>after</strong> this date',
            'disabled': true
        })
    }}

    {{
        form.content({
            'label': 'Manage upcoming occurences',
            'show-label': false,
            'value': html.button({
                'label': html.icon('calendar') ~ '&nbsp;&nbsp;Manage Upcoming Occurrences',
                'data-toggle': 'modal',
                'href': '#upcoming',
                'type': 'link'
            })
        })
    }}

    {{ form.fieldset_end() }}
	

    {{
        form.end({
            'actions': [
                form.submit({
                    'class': 'btn--primary',
                    'label': 'Save'
                }),
                html.button({
                    'class': 'btn--naked',
                    'type': 'link',
                    'label': 'Cancel',
                    'href': '#'
                })
            ]
        })
    }}

    <!-- NOT PRODUCTION QUALITY!!!!!!!! DO NOT SHIP THIS JAVASCRIPT!!!!! -->
    <script>
        (function ($) {
            $(window).load(function(){

                $('[data-show="js-set-occurence"]').on('click', function(e) {
                    e.preventDefault();
                    $('.js-set-occurence').removeClass('hide');

                });
            });
        }(jQuery));
    </script>


    <div class="modal" id="upcoming" style="min-width: 600px;">
        <div class="modal__dialog">
            <div class="modal__content">
                <div class="modal__header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h1 class="modal__title">Upcoming Occurrences</h1>
                    {{
                        form.create({})
                    }}
                </div>
                <div class="modal__body">
                    <p>This is a list of the dates this event will repeat on, based on your repeat patterns. Dates in the past are not displayed.</p>
                    <p>You may add one-off occurences to this list, or deactivate occurences to stop the event repeating on specific dates.</p>
                    {{
                        html.button({
                            'label': 'Add Occurence',
                            'class': 'u-margin-bottom u-margin-top',
                            'data-show': 'js-set-occurence'
                        })
                    }}
                    {{
                        html.button({
                            'label': 'Disable Selected',
                            'class': 'is-disabled u-margin-bottom'
                        })
                    }}

                    {{
                        form.date({
                            'label': 'Add occurence',
                            'class': 'form__group--large u-margin-top hide js-set-occurence',
                            'prepend': html.icon('calendar'),
                            'id': 'new-occurence',
                            'name': 'new-occurence',
                            'append': html.button({
                                'label': 'Add',
                                'class': 'btn--primary'
                            }),
                            'append_type': 'button'
                        })
                    }}

                    {{ 
                        html.datatable({
                            'data-order': '[[ 1, "asc" ]]',
                            'data-select': 'false',
                            'class': 'table--full',
                            'data-page-length': '10',
                            'data': data
                        }) 
                    }}
                </div>
                <div class="modal__footer">
                    {{
                        form.end({
                            'actions': [
                                form.submit({
                                    'class': 'btn--primary',
                                    'label': 'Done',
                                    'data-dismiss': 'modal'
                                }),
                                html.button({
                                    'class': 'btn--naked',
                                    'type': 'link',
                                    'label': 'Cancel',
                                    'href': '#',
                                    'data-dismiss': 'modal'
                                })
                            ]
                        })
                    }}
                </div>
            </div><!-- /.modal__content -->
        </div><!-- /.modal__dialog -->
    </div><!-- /.modal -->

{% endblock %}
